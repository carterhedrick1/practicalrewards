<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TXPB5KSTNP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-TXPB5KSTNP');
    </script>
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "t8qvj4h0gj");
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Cards - Practical Rewards</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon.png">
    <link rel="manifest" href="/favicons/site.webmanifest">

    <style>
        /* Modern CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            line-height: 1.6;
            color: #292524;
            background: #fafaf9;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Header - Modern Desktop Navigation */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #0f2027 0%, #0f2027 30%, #203a43 70%, #2c5364 100%);
            backdrop-filter: blur(20px);
            border-bottom: none;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #a8e6cf;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .logo:hover {
            color: #e8f4f8;
            transform: translateY(-1px);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 3rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #c2e9e0;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem 0;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #059669, #10b981);
            transition: width 0.3s ease;
        }

        .nav-links a:hover {
            color: #a8e6cf;
            transform: translateX(4px);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .cta-nav {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #047857 !important;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(254, 243, 199, 0.4);
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .cta-nav::after {
            display: none;
        }

        .cta-nav:hover {
            color: #047857 !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(254, 243, 199, 0.6);
            background: linear-gradient(135deg, #fde68a 0%, #fef3c7 100%);
        }

        /* Header toggle and hamburger styles come from header.html to ensure consistency */

        /* Footer */
        footer {
            background: #292524;
            color: #a8a29e;
            padding: 3rem 0 1rem 0;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.125rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 0.75rem;
        }

        .footer-section ul li a {
            color: #a8a29e;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-section ul li a:hover {
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid #44403c;
            padding-top: 1rem;
            text-align: center;
            font-size: 0.875rem;
        }

        /* Cards Grid Page Styles */
        .cards-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 120px 2rem 2rem 2rem;
        }

        .hero-section {
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #047857 0%, #059669 100%);
            color: white;
            margin: 0 -2rem 3rem -2rem;
            overflow: hidden;
            width: 100vw;
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
            text-align: center;
            margin-top: -130px;
        }

        .hero-section h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 800;
        }

        .hero-subtitle {
            font-size: 1.4rem;
            font-weight: 500;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 1rem auto;
        }

        .hero-description {
            font-size: 1.1rem;
            font-weight: 400;
            opacity: 0.85;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Filter Pills Section */
        .filter-pills-section {
            margin-bottom: 2rem;
        }

        .filter-pills {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .filter-pills {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .filter-pill {
            position: relative;
        }

        .pill-button {
            padding: 0.75rem 1.25rem;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            color: #475569;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 120px;
            justify-content: space-between;
        }

        .pill-button:hover {
            border-color: #059669;
            background: #f0fdf4;
        }

        .pill-arrow {
            font-size: 0.8rem;
            transition: transform 0.2s ease;
        }

        .pill-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            min-width: max-content;
            max-width: 90vw;
            z-index: 1000;
            display: none;
            margin-top: 0.5rem;
        }

        .pill-dropdown.active {
            display: block;
        }

        .dropdown-content {
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .dropdown-content label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            cursor: pointer;
            font-size: 0.9rem;
            color: #374151;
            white-space: nowrap;
        }

        .dropdown-content input[type="radio"],
        .dropdown-content input[type="checkbox"] {
            margin: 0;
        }

        .filter-description {
            font-size: 0.85rem;
            color: #6b7280;
            font-style: italic;
            margin-bottom: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .dropdown-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            background: #f8fafc;
            border-radius: 0 0 12px 12px;
        }

        .reset-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            color: #6b7280;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reset-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .apply-btn {
            padding: 0.5rem 1rem;
            background: #059669;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .apply-btn:hover {
            background: #047857;
        }

        /* Active Filters Line */
        .active-filters-line {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .active-filters-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .active-filters-left {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .active-filters-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .results-summary {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }



        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .active-filter-chip {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: #059669;
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .remove-filter {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .remove-filter:hover {
            background: rgba(255,255,255,0.2);
        }

        .clear-all-btn {
            background: none;
            border: none;
            color: #3b82f6;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: underline;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .clear-all-btn:hover {
            background: #eff6ff;
            color: #1d4ed8;
        }

        /* Mobile Quick Filter Pills */
        .mobile-quick-filters {
            display: none;
            gap: 0.75rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mobile-quick-pill {
            padding: 0.75rem 1.25rem;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            color: #475569;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 100px;
            justify-content: center;
        }

        .mobile-quick-pill:hover {
            border-color: #059669;
            background: #f0fdf4;
        }

        .mobile-quick-pill.active {
            background: #059669;
            color: white;
            border-color: #059669;
        }

        .filters-icon {
            font-size: 1.1rem;
        }

        /* Mobile Filters Overlay */
        .mobile-filters-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            overflow-y: auto;
        }

        .mobile-filters-overlay.active {
            display: block;
        }

        .mobile-filters-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .mobile-filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
            border-radius: 20px 20px 0 0;
        }

        .mobile-filters-title h3 {
            margin: 0;
            font-size: 1.1rem;
            color: #1e293b;
            font-weight: 600;
        }

        .mobile-filters-title p {
            margin: 0.25rem 0 0 0;
            font-size: 0.9rem;
            color: #64748b;
        }

        .mobile-filters-actions {
            display: flex;
            gap: 0.75rem;
        }

        .mobile-reset-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            color: #6b7280;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .mobile-done-btn {
            padding: 0.5rem 1rem;
            background: #059669;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
        }

        .mobile-filters-body {
            padding: 1rem;
        }

        .mobile-filter-section {
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .mobile-filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8fafc;
            cursor: pointer;
            border-bottom: 1px solid #e2e8f0;
        }

        .mobile-filter-header h4 {
            margin: 0;
            font-size: 1rem;
            color: #1e293b;
            font-weight: 500;
        }

        .mobile-arrow {
            font-size: 0.8rem;
            transition: transform 0.2s ease;
        }

        .mobile-filter-header.expanded .mobile-arrow {
            transform: rotate(180deg);
        }

        .mobile-filter-options {
            padding: 1rem;
            display: none;
        }

        .mobile-filter-options.expanded {
            display: block;
        }

        .mobile-filter-options label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            cursor: pointer;
            font-size: 0.9rem;
            color: #374151;
        }

        .mobile-filter-options input[type="radio"],
        .mobile-filter-options input[type="checkbox"] {
            margin: 0;
        }

        .mobile-filters-footer {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            text-align: center;
        }

        .mobile-show-results-btn {
            width: 100%;
            padding: 1rem;
            background: #059669;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .mobile-show-results-btn:hover {
            background: #047857;
        }

        .filter-results {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-top: 1px solid #e2e8f0;
        }

        .results-count {
            color: #64748b;
            font-size: 0.9rem;
        }



        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .card-item {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            border: 1px solid #e5e7eb;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            display: block;
            opacity: 1;
            transform: scale(1);
            text-align: center;
        }

        .card-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .card-item:hover::before {
            left: 100%;
        }

        .card-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: #059669;
        }

        .card-image {
            width: 100%;
            max-width: 200px;
            height: 140px;
            object-fit: contain;
            margin-bottom: 0.75rem;
            border-radius: 8px;
            box-shadow: none;
            border: none;
            transition: transform 0.3s ease;
        }

        .card-item:hover .card-image {
            transform: scale(1.02);
        }

        .card-image-fallback {
            width: 100%;
            max-width: 240px;
            height: 140px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            box-shadow: none;
            border: none;
        }

        .card-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 0.75rem;
            height: 40px;
            flex-shrink: 0;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
            line-height: 1.3;
            text-align: center;
        }

        .card-meta-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            justify-content: center;
            height: 32px;
            align-items: center;
            flex-shrink: 0;
        }

        .meta-chip {
            background: #f1f5f9;
            color: #64748b;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .card-earning-rates {
            color: #374151;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            line-height: 1.3;
            text-align: center;
        }

        .card-perks {
            color: #6b7280;
            font-size: 0.75rem;
            line-height: 1.3;
            margin-bottom: 0.5rem;
            text-align: center;
        }



        .card-line-label {
            font-weight: 600;
            color: #374151;
            margin-right: 0.5rem;
        }

        .card-line-content {
            color: #64748b;
        }

        .card-advice {
            background: #f8fafc;
            border-left: 3px solid #059669;
            padding: 1rem;
            margin-top: 0.75rem;
            border-radius: 0 8px 8px 0;
            text-align: center;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        .card-advice-label {
            font-weight: 600;
            color: #059669;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .card-advice-text {
            color: #475569;
            font-size: 0.75rem;
            line-height: 1.4;
            font-style: italic;
            text-align: center;
            max-width: 100%;
        }



        /* Loading states */
        .loading-placeholder {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            color: #6b7280;
            margin: 1rem 0;
        }

        .loading-placeholder::before {
            content: "Loading...";
            display: block;
            margin-bottom: 1rem;
        }

        /* Tablet Responsive */
        @media (min-width: 769px) and (max-width: 1024px) {
            .nav-links {
                gap: 2rem;
            }

            nav {
                padding: 0 1.5rem;
            }

            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        @media (max-width: 768px) {
            /* Show mobile menu toggle */
            .mobile-menu-toggle {
                display: flex;
            }

            /* Hide desktop navigation */
            .nav-links {
                display: none;
            }

            nav {
                padding: 0 1rem;
                height: 70px;
            }

            .cards-container {
                padding: 100px 1rem 2rem 1rem;
            }

            .hero-section {
                margin: -125px -1rem 3rem -1rem;
                padding: 2rem 1rem;
                width: 100vw;
                position: relative;
                left: 50%;
                right: 50%;
                margin-left: -50vw;
                margin-right: -50vw;
            }

            .hero-section h1 {
                font-size: 2.5rem;
            }

            .hero-subtitle {
                font-size: 1.2rem;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .filter-header {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-pills {
                display: none;
            }

            .mobile-quick-filters {
                display: flex;
                margin-top: 1rem;
            }

            .pill-dropdown {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 90vw;
                min-width: 280px;
                max-height: 80vh;
            }

            .card-image {
                max-width: 200px;
                height: 120px;
            }

            .card-image-fallback {
                max-width: 200px;
                height: 120px;
            }



        .card-item.fade-out {
            opacity: 0;
            transform: scale(0.95);
        }

        .card-item.fade-in {
            animation: fadeInScale 0.3s ease-out forwards;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .cards-grid {
            transition: all 0.3s ease-in-out;
        }


        }
    </style>
</head>
<body>
    <!-- Header placeholder -->
    <div id="header-placeholder">
        <div class="loading-placeholder">Loading navigation...</div>
    </div>

    <div class="cards-container">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1>Build your card lineup.</h1>
            <p class="hero-subtitle">Set your filters, weigh the perks, and pick what actually earns for you.</p>
        </div>

        <!-- Filter Pills Section -->
        <div class="filter-pills-section">
            <div class="filter-pills">
                <div class="filter-pill" data-filter="type">
                    <button class="pill-button" onclick="toggleFilterDropdown('type')">
                        <span class="pill-label">Card Type</span>
                        <span class="pill-arrow">▼</span>
                    </button>
                    <div class="pill-dropdown" id="type-dropdown">
                        <div class="dropdown-content">
                            <label><input type="checkbox" name="type" value="travel" onchange="autoApplyFilters()"> Travel</label>
                            <label><input type="checkbox" name="type" value="cashback" onchange="autoApplyFilters()"> Cashback</label>
                            <label><input type="checkbox" name="type" value="hybrid" onchange="autoApplyFilters()"> Hybrid</label>
                            <label><input type="checkbox" name="type" value="business" onchange="autoApplyFilters()"> Business</label>
                        </div>
                        <div class="dropdown-footer">
                            <button class="reset-btn" onclick="resetFilter('type')">Reset</button>
                        </div>
                    </div>
                </div>

                <div class="filter-pill" data-filter="issuer">
                    <button class="pill-button" onclick="toggleFilterDropdown('issuer')">
                        <span class="pill-label">Banks</span>
                        <span class="pill-arrow">▼</span>
                    </button>
                    <div class="pill-dropdown" id="issuer-dropdown">
                        <div class="dropdown-content">
                                            <label><input type="checkbox" name="issuer" value="amex" onchange="autoApplyFilters()"> American Express</label>
                <label><input type="checkbox" name="issuer" value="chase" onchange="autoApplyFilters()"> Chase</label>
                <label><input type="checkbox" name="issuer" value="capital-one" onchange="autoApplyFilters()"> Capital One</label>
                <label><input type="checkbox" name="issuer" value="wells-fargo" onchange="autoApplyFilters()"> Wells Fargo</label>
                <label><input type="checkbox" name="issuer" value="citi" onchange="autoApplyFilters()"> Citi</label>
                <label><input type="checkbox" name="issuer" value="discover" onchange="autoApplyFilters()"> Discover</label>
                <label><input type="checkbox" name="issuer" value="bilt" onchange="autoApplyFilters()"> Bilt</label>
                <label><input type="checkbox" name="issuer" value="bank-of-america" onchange="autoApplyFilters()"> Bank of America</label>
                <label><input type="checkbox" name="issuer" value="us-bank" onchange="autoApplyFilters()"> U.S. Bank</label>
                <label><input type="checkbox" name="issuer" value="fidelity" onchange="autoApplyFilters()"> Fidelity</label>
                        </div>
                        <div class="dropdown-footer">
                            <button class="reset-btn" onclick="resetFilter('issuer')">Reset</button>
                        </div>
                    </div>
                </div>

                <div class="filter-pill" data-filter="airline-hotel">
                    <button class="pill-button" onclick="toggleFilterDropdown('airline-hotel')">
                        <span class="pill-label">Airlines / Hotels</span>
                        <span class="pill-arrow">▼</span>
                    </button>
                    <div class="pill-dropdown" id="airline-hotel-dropdown">
                        <div class="dropdown-content">
                            <label><input type="checkbox" name="airline-hotel" value="delta" onchange="autoApplyFilters()"> Delta</label>
                            <label><input type="checkbox" name="airline-hotel" value="united" onchange="autoApplyFilters()"> United</label>
                            <label><input type="checkbox" name="airline-hotel" value="american" onchange="autoApplyFilters()"> American Airlines</label>
                            <label><input type="checkbox" name="airline-hotel" value="southwest" onchange="autoApplyFilters()"> Southwest</label>
                            <label><input type="checkbox" name="airline-hotel" value="jetblue" onchange="autoApplyFilters()"> JetBlue</label>
                            <label><input type="checkbox" name="airline-hotel" value="alaska" onchange="autoApplyFilters()"> Alaska Airlines</label>
                            <label><input type="checkbox" name="airline-hotel" value="marriott" onchange="autoApplyFilters()"> Marriott</label>
                            <label><input type="checkbox" name="airline-hotel" value="hilton" onchange="autoApplyFilters()"> Hilton</label>
                            <label><input type="checkbox" name="airline-hotel" value="hyatt" onchange="autoApplyFilters()"> Hyatt</label>
                            <label><input type="checkbox" name="airline-hotel" value="ihg" onchange="autoApplyFilters()"> IHG</label>
                        </div>
                        <div class="dropdown-footer">
                            <button class="reset-btn" onclick="resetFilter('airline-hotel')">Reset</button>
                        </div>
                    </div>
                </div>

                <div class="filter-pill" data-filter="fee">
                    <button class="pill-button" onclick="toggleFilterDropdown('fee')">
                        <span class="pill-label">Annual Fee</span>
                        <span class="pill-arrow">▼</span>
                    </button>
                    <div class="pill-dropdown" id="fee-dropdown">
                        <div class="dropdown-content">
                            <label><input type="checkbox" name="fee" value="0-100" onchange="autoApplyFilters()"> $0-$100</label>
                            <label><input type="checkbox" name="fee" value="100-300" onchange="autoApplyFilters()"> $100-$300</label>
                            <label><input type="checkbox" name="fee" value="300-500" onchange="autoApplyFilters()"> $300-$500</label>
                            <label><input type="checkbox" name="fee" value="500+" onchange="autoApplyFilters()"> $500+</label>
                        </div>
                        <div class="dropdown-footer">
                            <button class="reset-btn" onclick="resetFilter('fee')">Reset</button>
                        </div>
                    </div>
                </div>

                <div class="filter-pill" data-filter="perks">
                    <button class="pill-button" onclick="toggleFilterDropdown('perks')">
                        <span class="pill-label">Perks</span>
                        <span class="pill-arrow">▼</span>
                    </button>
                    <div class="pill-dropdown" id="perks-dropdown">
                        <div class="dropdown-content">
                                    <label><input type="checkbox" name="perks" value="lounge-access" onchange="autoApplyFilters()"> Lounge Access</label>
        <label><input type="checkbox" name="perks" value="tsa-precheck" onchange="autoApplyFilters()"> TSA Pre/Global Entry</label>
        <label><input type="checkbox" name="perks" value="clear" onchange="autoApplyFilters()"> CLEAR</label>
        <label><input type="checkbox" name="perks" value="no-foreign-fees" onchange="autoApplyFilters()"> No Foreign Transaction Fees</label>
        <label><input type="checkbox" name="perks" value="metal-card" onchange="autoApplyFilters()"> Metal Card</label>
        <label><input type="checkbox" name="perks" value="free-checked-bags" onchange="autoApplyFilters()"> Free Checked Bags</label>
        <label><input type="checkbox" name="perks" value="priority-boarding" onchange="autoApplyFilters()"> Priority Boarding</label>
        <label><input type="checkbox" name="perks" value="annual-free-night" onchange="autoApplyFilters()"> Annual Free Night</label>
        <label><input type="checkbox" name="perks" value="automatic-elite-status" onchange="autoApplyFilters()"> Automatic Elite Status</label>
                        </div>
                        <div class="dropdown-footer">
                            <button class="reset-btn" onclick="resetFilter('perks')">Reset</button>
                        </div>
                    </div>
                </div>

                <div class="filter-pill" data-filter="protections">
                    <button class="pill-button" onclick="toggleFilterDropdown('protections')">
                        <span class="pill-label">Protections</span>
                        <span class="pill-arrow">▼</span>
                    </button>
                    <div class="pill-dropdown" id="protections-dropdown">
                        <div class="dropdown-content">
                            <label><input type="checkbox" name="protections" value="trip-delay-cancellation" onchange="autoApplyFilters()"> Trip Delay & Cancellation Insurance</label>
                            <label><input type="checkbox" name="protections" value="lost-delayed-baggage" onchange="autoApplyFilters()"> Lost/Delayed Baggage Insurance</label>
                            <label><input type="checkbox" name="protections" value="rental-car-insurance" onchange="autoApplyFilters()"> Primary Rental Car Coverage</label>
                            <label><input type="checkbox" name="protections" value="cell-phone-protection" onchange="autoApplyFilters()"> Cell Phone Protection</label>
                            <label><input type="checkbox" name="protections" value="purchase-protection" onchange="autoApplyFilters()"> Purchase Protection</label>
                            <label><input type="checkbox" name="protections" value="extended-warranty" onchange="autoApplyFilters()"> Extended Warranty</label>
                        </div>
                        <div class="dropdown-footer">
                            <button class="reset-btn" onclick="resetFilter('protections')">Reset</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Quick Filter Pills -->
            <div class="mobile-quick-filters">
                <button class="mobile-quick-pill" onclick="openMobileFilters()">
                    <span class="filters-icon">☰</span>
                    Filters
                </button>
                <button class="mobile-quick-pill" onclick="quickFilter('type', 'travel')">
                    Travel
                </button>
                <button class="mobile-quick-pill" onclick="quickFilter('type', 'cashback')">
                    Cash Back
                </button>
            </div>
        </div>

        <!-- Active Filters Line -->
        <div class="active-filters-line" id="active-filters-line" style="display: none;">
            <div class="active-filters-content">
                <div class="active-filters-left">
                    <div class="active-filters-chips" id="active-filters-chips">
                        <!-- Active filter chips will be displayed here -->
                    </div>
                    <div class="results-summary">
                        <span id="results-count">0</span> of <span id="total-count">0</span> cards found
                    </div>
                </div>
                <button class="clear-all-btn" onclick="resetAllFilters()">CLEAR ALL</button>
            </div>
        </div>





        <!-- Cards Grid -->
        <div class="cards-grid" id="cards-grid">
            <!-- Cards will be dynamically loaded here -->
        </div>

        <!-- Mobile Filters Overlay -->
        <div class="mobile-filters-overlay" id="mobile-filters-overlay">
            <div class="mobile-filters-content">
                <div class="mobile-filters-header">
                    <div class="mobile-filters-title">
                        <h3>FILTERS (<span id="mobile-active-count">0</span>)</h3>
                        <p id="mobile-results-count">0 FOUND</p>
                    </div>
                    <div class="mobile-filters-actions">
                        <button class="mobile-reset-btn" onclick="resetAllFilters()">Reset</button>
                        <button class="mobile-done-btn" onclick="closeMobileFilters()">Done</button>
                    </div>
                </div>

                <div class="mobile-filters-body">
                    <!-- Card Type Section -->
                    <div class="mobile-filter-section">
                        <div class="mobile-filter-header" onclick="toggleMobileSection('type')">
                            <h4>Card Type</h4>
                            <span class="mobile-arrow">▼</span>
                        </div>
                        <div class="mobile-filter-options" id="mobile-type-options">
                            <label><input type="checkbox" name="mobile-type" value="travel" onchange="autoApplyMobileFilters()"> Travel</label>
                            <label><input type="checkbox" name="mobile-type" value="cashback" onchange="autoApplyMobileFilters()"> Cashback</label>
                            <label><input type="checkbox" name="mobile-type" value="hybrid" onchange="autoApplyMobileFilters()"> Hybrid</label>
                            <label><input type="checkbox" name="mobile-type" value="business" onchange="autoApplyMobileFilters()"> Business</label>
                        </div>
                    </div>

                    <!-- Issuer Section -->
                    <div class="mobile-filter-section">
                        <div class="mobile-filter-header" onclick="toggleMobileSection('issuer')">
                            <h4>Banks</h4>
                            <span class="mobile-arrow">▼</span>
                        </div>
                        <div class="mobile-filter-options" id="mobile-issuer-options">
                                            <label><input type="checkbox" name="mobile-issuer" value="amex" onchange="autoApplyMobileFilters()"> American Express</label>
                <label><input type="checkbox" name="mobile-issuer" value="chase" onchange="autoApplyMobileFilters()"> Chase</label>
                <label><input type="checkbox" name="mobile-issuer" value="capital-one" onchange="autoApplyMobileFilters()"> Capital One</label>
                <label><input type="checkbox" name="mobile-issuer" value="wells-fargo" onchange="autoApplyMobileFilters()"> Wells Fargo</label>
                <label><input type="checkbox" name="mobile-issuer" value="citi" onchange="autoApplyMobileFilters()"> Citi</label>
                <label><input type="checkbox" name="mobile-issuer" value="discover" onchange="autoApplyMobileFilters()"> Discover</label>
                <label><input type="checkbox" name="mobile-issuer" value="bilt" onchange="autoApplyMobileFilters()"> Bilt</label>
                <label><input type="checkbox" name="mobile-issuer" value="bank-of-america" onchange="autoApplyMobileFilters()"> Bank of America</label>
                <label><input type="checkbox" name="mobile-issuer" value="us-bank" onchange="autoApplyMobileFilters()"> U.S. Bank</label>
                <label><input type="checkbox" name="mobile-issuer" value="fidelity" onchange="autoApplyMobileFilters()"> Fidelity</label>
                        </div>
                    </div>

                    <!-- Airline/Hotel Section -->
                    <div class="mobile-filter-section">
                        <div class="mobile-filter-header" onclick="toggleMobileSection('airline-hotel')">
                            <h4>Airlines / Hotels</h4>
                            <span class="mobile-arrow">▼</span>
                        </div>
                        <div class="mobile-filter-options" id="mobile-airline-hotel-options">
                            <label><input type="checkbox" name="mobile-airline-hotel" value="delta" onchange="autoApplyMobileFilters()"> Delta</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="united" onchange="autoApplyMobileFilters()"> United</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="american" onchange="autoApplyMobileFilters()"> American Airlines</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="southwest" onchange="autoApplyMobileFilters()"> Southwest</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="jetblue" onchange="autoApplyMobileFilters()"> JetBlue</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="alaska" onchange="autoApplyMobileFilters()"> Alaska Airlines</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="marriott" onchange="autoApplyMobileFilters()"> Marriott</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="hilton" onchange="autoApplyMobileFilters()"> Hilton</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="hyatt" onchange="autoApplyMobileFilters()"> Hyatt</label>
                            <label><input type="checkbox" name="mobile-airline-hotel" value="ihg" onchange="autoApplyMobileFilters()"> IHG</label>
                        </div>
                    </div>

                    <!-- Annual Fee Section -->
                    <div class="mobile-filter-section">
                        <div class="mobile-filter-header" onclick="toggleMobileSection('fee')">
                            <h4>Annual Fee</h4>
                            <span class="mobile-arrow">▼</span>
                        </div>
                        <div class="mobile-filter-options" id="mobile-fee-options">
                            <label><input type="checkbox" name="mobile-fee" value="0-100" onchange="autoApplyMobileFilters()"> $0-$100</label>
                            <label><input type="checkbox" name="mobile-fee" value="100-300" onchange="autoApplyMobileFilters()"> $100-$300</label>
                            <label><input type="checkbox" name="mobile-fee" value="300-500" onchange="autoApplyMobileFilters()"> $300-$500</label>
                            <label><input type="checkbox" name="mobile-fee" value="500+" onchange="autoApplyMobileFilters()"> $500+</label>
                        </div>
                    </div>

                    <!-- Perks Section -->
                    <div class="mobile-filter-section">
                        <div class="mobile-filter-header" onclick="toggleMobileSection('perks')">
                            <h4>Perks</h4>
                            <span class="mobile-arrow">▼</span>
                        </div>
                        <div class="mobile-filter-options" id="mobile-perks-options">
                                    <label><input type="checkbox" name="mobile-perks" value="lounge-access" onchange="autoApplyMobileFilters()"> Lounge Access</label>
        <label><input type="checkbox" name="mobile-perks" value="tsa-precheck" onchange="autoApplyMobileFilters()"> TSA Pre/Global Entry</label>
        <label><input type="checkbox" name="mobile-perks" value="clear" onchange="autoApplyMobileFilters()"> CLEAR</label>
        <label><input type="checkbox" name="mobile-perks" value="no-foreign-fees" onchange="autoApplyMobileFilters()"> No Foreign Transaction Fees</label>
        <label><input type="checkbox" name="mobile-perks" value="metal-card" onchange="autoApplyMobileFilters()"> Metal Card</label>
        <label><input type="checkbox" name="mobile-perks" value="free-checked-bags" onchange="autoApplyMobileFilters()"> Free Checked Bags</label>
        <label><input type="checkbox" name="mobile-perks" value="priority-boarding" onchange="autoApplyMobileFilters()"> Priority Boarding</label>
        <label><input type="checkbox" name="mobile-perks" value="annual-free-night" onchange="autoApplyMobileFilters()"> Annual Free Night</label>
        <label><input type="checkbox" name="mobile-perks" value="automatic-elite-status" onchange="autoApplyMobileFilters()"> Automatic Elite Status</label>
                        </div>
                    </div>

                    <!-- Protections Section -->
                    <div class="mobile-filter-section">
                        <div class="mobile-filter-header" onclick="toggleMobileSection('protections')">
                            <h4>Protections</h4>
                            <span class="mobile-arrow">▼</span>
                        </div>
                        <div class="mobile-filter-options" id="mobile-protections-options">
                            <label><input type="checkbox" name="mobile-protections" value="trip-delay-cancellation" onchange="autoApplyMobileFilters()"> Trip Delay & Cancellation Insurance</label>
                            <label><input type="checkbox" name="mobile-protections" value="lost-delayed-baggage" onchange="autoApplyMobileFilters()"> Lost/Delayed Baggage Insurance</label>
                            <label><input type="checkbox" name="mobile-protections" value="rental-car-insurance" onchange="autoApplyMobileFilters()"> Primary Rental Car Coverage</label>
                            <label><input type="checkbox" name="mobile-protections" value="cell-phone-protection" onchange="autoApplyMobileFilters()"> Cell Phone Protection</label>
                            <label><input type="checkbox" name="mobile-protections" value="purchase-protection" onchange="autoApplyMobileFilters()"> Purchase Protection</label>
                            <label><input type="checkbox" name="mobile-protections" value="extended-warranty" onchange="autoApplyMobileFilters()"> Extended Warranty</label>
                        </div>
                    </div>


                </div>

                <div class="mobile-filters-footer">
                    <button class="mobile-show-results-btn" onclick="applyMobileFilters()">
                        Show Results (<span id="mobile-results-btn-count">0</span>)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer placeholder -->
    <div id="footer-placeholder">
        <div class="loading-placeholder">Loading footer...</div>
    </div>

    <script>
        // Smart header and footer loading with fallbacks
        document.addEventListener('DOMContentLoaded', function() {
            // Load header
            loadComponent('header.html', 'header-placeholder', 'header-fallback');
            
            // Load footer
            loadComponent('footer.html', 'footer-placeholder', 'footer-fallback');

            // Initialize cards and filters
            initializeCards().then(() => {
                initializeFilters();
            }).catch(error => {
                console.error('Failed to initialize cards:', error);
                initializeFilters(); // Still initialize filters even if cards fail
            });
        });

        function loadComponent(filename, placeholderId, fallbackId) {
            const placeholder = document.getElementById(placeholderId);
            
            // Try to load the component
            fetch(filename)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(html => {
                    console.log(`Successfully loaded ${filename}, length:`, html.length);
                    
                    // Extract and execute JavaScript from the loaded HTML
                    if (filename === 'header.html') {
                        // Extract script tags
                        const scriptRegex = /<script[^>]*>([\s\S]*?)<\/script>/gi;
                        const scripts = [];
                        let match;
                        
                        while ((match = scriptRegex.exec(html)) !== null) {
                            scripts.push(match[1]);
                        }
                        
                        console.log(`Found ${scripts.length} script tags in header`);
                        
                        // Execute each script
                        scripts.forEach((script, index) => {
                            console.log(`Executing script ${index + 1}`);
                            try {
                                eval(script);
                            } catch (error) {
                                console.error(`Error executing script ${index + 1}:`, error);
                            }
                        });
                        
                        // Remove script tags from HTML before inserting
                        const cleanHtml = html.replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '');
                        placeholder.innerHTML = cleanHtml;
                    } else {
                        // For non-header files, just insert the HTML
                        placeholder.innerHTML = html;
                    }
                    
                    // Initialize any JavaScript functionality in the loaded content
                    if (typeof window.attachHeaderScrollBehavior === 'function') {
                        window.attachHeaderScrollBehavior();
                    }
                })
                .catch(error => {
                    console.warn(`Could not load ${filename}:`, error);
                    
                    // Show fallback content
                    placeholder.innerHTML = getFallbackContent(filename);
                });
        }

        function getFallbackContent(filename) {
            if (filename === 'header.html') {
                return '';
            } else if (filename === 'footer.html') {
                return `
                    <footer style="background: #292524; color: #a8a29e; padding: 3rem 0 1rem 0; margin-top: 3rem;">
                        <div style="max-width: 1400px; margin: 0 auto; padding: 0 2rem;">
                            <div style="text-align: center;">
                                <p>&copy; 2025 Practical Rewards. All rights reserved.</p>
                                <p style="margin-top: 1rem;">
                                    <a href="learning.html" style="color: #a8a29e; text-decoration: none; margin: 0 1rem;">Learning</a>
                                    <a href="cards.html" style="color: #a8a29e; text-decoration: none; margin: 0 1rem;">Cards</a>
                                    <a href="about.html" style="color: #a8a29e; text-decoration: none; margin: 0 1rem;">About</a>
                                </p>
                            </div>
                        </div>
                    </footer>
                `;
            }
            return '<p>Content could not be loaded.</p>';
        }

        function initializeLoadedContent() {
            // Initialize header scroll effects
            const header = document.querySelector('header');
            if (header) {
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 100) {
                        header.style.background = 'linear-gradient(135deg, rgba(15, 32, 39, 0.98) 0%, rgba(32, 58, 67, 0.98) 70%, rgba(44, 83, 100, 0.98) 100%)';
                        header.style.boxShadow = '0 4px 20px rgba(168, 230, 207, 0.2)';
                    } else {
                        header.style.background = 'linear-gradient(135deg, #0f2027 0%, #0f2027 30%, #203a43 70%, #2c5364 100%)';
                        header.style.boxShadow = 'none';
                    }
                });
            }

            // Initialize mobile menu functionality
            const mobileToggle = document.querySelector('.mobile-menu-toggle');
            if (mobileToggle) {
                mobileToggle.addEventListener('click', function() {
                    console.log('Mobile menu toggle clicked');
                    // Add mobile menu functionality here
                });
            }
        }

        // Cards data and functionality
        let allCards = [];
        let filteredCards = [];

        async function initializeCards() {
            try {
                console.log('📥 Fetching cards.json...');
                const response = await fetch('cards.json', { cache: 'no-store' });
                if (!response.ok) {
                    throw new Error(`Failed to fetch cards.json: ${response.status}`);
                }
                const databaseCards = await response.json();
                console.log('✅ Static JSON fetch successful, received cards:', databaseCards);
                console.log('🔍 First card details:', databaseCards[0]);
                
                // Convert database format to match your existing code
                let allCardsFromDB = databaseCards.map(card => {
                    console.log('🔍 Processing card:', card);
                    const parseArrayField = (field) => {
                        if (!field || field === '0' || field === 0) return [];
                        if (Array.isArray(field)) return field;
                        if (typeof field === 'string') {
                            try {
                                let cleanField = field.trim();
                                if (cleanField.startsWith('"') && cleanField.endsWith('"')) cleanField = cleanField.slice(1, -1);
                                if (cleanField.startsWith('"[') && cleanField.endsWith(']"')) cleanField = cleanField.slice(1, -1);
                                const parsed = JSON.parse(cleanField);
                                if (Array.isArray(parsed)) {
                                    return parsed.map(item => (typeof item === 'string' && item.startsWith('"') && item.endsWith('"')) ? item.slice(1, -1) : item);
                                }
                                return Array.isArray(parsed) ? parsed : [];
                            } catch (_) { return []; }
                        }
                        return [];
                    };
                    return {
                        id: card.id,
                        name: card.name,
                        type: card.type,
                        annualFee: card.annual_fee,
                        bankType: card.bank_type,
                        rewards: card.rewards_type,
                        image: card.image_url,
                        welcomeBonus: card.welcome_bonus || card.welcomeBonus || 'None',
                        practicalAdvice: card.practical_advice || card.practicalAdvice || '',
                        features: Array.isArray(card.features) ? card.features : parseArrayField(card.features),
                        perks: [],
                        protections: [],
                        featureCategories: card.feature_categories || [],
                        perkCategories: parseArrayField(card.perk_categories),
                        protectionCategories: parseArrayField(card.protection_categories),
                        airline_hotels: parseArrayField(card.airline_hotels),
                        earningCategories: parseArrayField(card.earning_categories),
                        url: card.card_url,
                        status: card.status || 'active'
                    };
                });
                
                // Filter to only show active cards
                allCards = allCardsFromDB.filter(card => card.status === 'active');
                console.log(`✅ Filtered ${allCardsFromDB.length} total cards to ${allCards.length} active cards`);
                
                console.log('✅ Converted cards:', allCards);
                console.log('✅ Final allCards array length:', allCards.length);
                
                if (allCards.length === 0) {
                    console.warn('⚠️ Warning: No active cards found in static JSON');
                } else {
                    console.log('✅ Successfully loaded cards from static JSON, proceeding...');
                }
            } catch (error) {
                console.error('Error loading cards from static JSON:', error);
                throw error;
            }

            // Initialize view with loaded data
            filteredCards = [...allCards];
            // Read filters from URL if any exist
            readFiltersFromURL();
            // Render and update counts
            renderCards();
            updateResultsCount();
        }

        function renderCards() {
            const grid = document.getElementById('cards-grid');
            const existingCards = grid.querySelectorAll('.card-item');
            
            console.log('renderCards called, existing cards:', existingCards.length);
            
            if (existingCards.length > 0) {
                console.log('Fading out existing cards with JavaScript animations...');
                
                // Use JavaScript to animate fade-out
                const fadeOutPromises = Array.from(existingCards).map((card, index) => {
                    return new Promise((resolve) => {
                        // Remove fade-in class and animation delays
                        card.classList.remove('fade-in');
                        card.style.animationDelay = '';
                        
                        // Set initial state
                        card.style.opacity = '1';
                        card.style.transform = 'scale(1)';
                        card.style.transition = 'opacity 0.3s ease-in-out, transform 0.3s ease-in-out';
                        
                        // Force a reflow to ensure initial state is applied
                        card.offsetHeight;
                        
                        // Animate to fade-out state
                        card.style.opacity = '0';
                        card.style.transform = 'scale(0.95)';
                        
                        // Resolve after animation completes
                        setTimeout(resolve, 300);
                    });
                });
                
                // Wait for all fade-out animations to complete
                Promise.all(fadeOutPromises).then(() => {
                    console.log('All fade-out animations completed, removing old cards...');
                    
                    // Remove old cards after they've faded out
                    existingCards.forEach(card => {
                        if (card.parentNode) {
                            card.parentNode.removeChild(card);
                        }
                    });
                    
                    // Add new cards with fade-in animation
                    filteredCards.forEach((card, index) => {
                        const cardElement = createCardElement(card);
                        cardElement.classList.add('fade-in');
                        cardElement.style.animationDelay = `${index * 50}ms`; // Stagger animation
                        grid.appendChild(cardElement);
                    });
                });
            } else {
                console.log('Initial load, adding cards with fade-in...');
                // Initial load - just add cards with fade-in animation
                filteredCards.forEach((card, index) => {
                    const cardElement = createCardElement(card);
                    cardElement.classList.add('fade-in');
                    cardElement.style.animationDelay = `${index * 50}ms`; // Stagger animation
                    grid.appendChild(cardElement);
                });
            }
        }

        function generatePracticalAdvice(card) {
            // Use database practical advice if available, otherwise generate it
            if (card.practical_advice || card.practicalAdvice) {
                return card.practical_advice || card.practicalAdvice;
            }
            
            // Generate practical advice based on card characteristics
            if (card.annualFee === 0) {
                if (card.type === 'cashback') {
                    return "Perfect starter card with no risk. Use for everyday spending and build credit history.";
                } else if (card.type === 'hybrid') {
                    return "Great for renters! Pay rent with this card to earn points on your biggest monthly expense.";
                } else {
                    return "No annual fee means this card pays for itself. Great for building credit and earning rewards.";
                }
            } else if (card.annualFee <= 95) {
                if (card.type === 'travel') {
                    return "Low annual fee for solid travel benefits. Make sure you'll use the credits to offset the cost.";
                } else {
                    return "Modest annual fee for enhanced rewards. Calculate if the extra earning rates justify the cost.";
                }
            } else if (card.annualFee <= 250) {
                if (card.name.includes('Venture X')) {
                    return "At $395/year, this is premium travel at a discount. The $300 travel credit + 10k anniversary miles make it worth it if you travel 2+ times per year.";
                } else {
                    return "Premium card with significant annual fee. Only worth it if you travel frequently and will use all the credits and benefits.";
                }
            } else {
                if (card.name.includes('Platinum')) {
                    return "The $695 fee is steep, but the credits add up quickly. Only get this if you'll use airline credits, hotel credits, and lounge access regularly.";
                } else if (card.name.includes('Reserve')) {
                    return "At $795/year, this is Chase's premium offering. The $300 travel credit helps, but you need to travel frequently to justify this cost.";
                } else {
                    return "High annual fee card. Carefully calculate if the benefits outweigh the cost for your specific spending patterns.";
                }
            }
        }

        function createCardElement(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card-item';
            cardDiv.onclick = () => window.location.href = card.url;

            // Format annual fee text (not red, not big)
            const feeText = card.annualFee === 0 ? 'No AF' : `$${card.annualFee} AF`;

            // Format welcome bonus (if available)
            const welcomeBonus = card.welcomeBonus || 'None';

            // Format earning rates (condensed)
            const earningRates = card.features ? card.features.slice(0, 3).join(' • ') : '';

            // Format perks using dedicated perks array
            const perks = card.perks ? card.perks.join(' • ') : '';

            // Format protections using dedicated protections array
            const protections = card.protections ? card.protections.join(' • ') : '';

            // Generate practical advice based on card type and features
            const advice = generatePracticalAdvice(card);

            cardDiv.innerHTML = `
                <img src="${card.image}" alt="${card.name}" class="card-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="card-image-fallback" style="display: none;">${card.name}</div>
                
                <div class="card-header">
                    <h3 class="card-title">${card.name}</h3>
                </div>
                
                <div class="card-meta-row">
                    <span class="meta-chip">${feeText}</span>
                    <span class="meta-chip">Welcome: ${welcomeBonus}</span>
                </div>
                
                <div class="card-earning-rates">
                    <strong>Earning:</strong> ${earningRates || '1x on everything'}
                </div>
                
                ${perks ? `<div class="card-perks">${perks}</div>` : ''}
                
                <div class="card-advice">
                    <div class="card-advice-label">Practical Advice</div>
                    <div class="card-advice-text">${advice}</div>
                </div>
            `;

            return cardDiv;
        }

        function initializeFilters() {
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.filter-pill')) {
                    closeAllDropdowns();
                }
            });
        }

        // New Google Flights style filter functions
        let activeFilters = {};

        function toggleFilterDropdown(filterType) {
            const dropdown = document.getElementById(`${filterType}-dropdown`);
            const isActive = dropdown.classList.contains('active');
            
            // Close all other dropdowns
            closeAllDropdowns();
            
            // Toggle current dropdown
            if (!isActive) {
                dropdown.classList.add('active');
                // Rotate arrow
                const arrow = dropdown.previousElementSibling.querySelector('.pill-arrow');
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.pill-dropdown').forEach(dropdown => {
                dropdown.classList.remove('active');
            });
            document.querySelectorAll('.pill-arrow').forEach(arrow => {
                arrow.style.transform = 'rotate(0deg)';
            });
        }

        function resetFilter(filterType) {
            // Reset all checkboxes for the given filter type
            document.querySelectorAll(`input[name="${filterType}"]`).forEach(cb => {
                cb.checked = false;
            });
            
            // Auto-apply the reset
            autoApplyFilters();
        }

        function applyFilter(filterType) {
            const dropdown = document.getElementById(`${filterType}-dropdown`);
            
            // Handle radio buttons
            const selectedValue = document.querySelector(`input[name="${filterType}"]:checked`).value;
            if (selectedValue !== 'all') {
                activeFilters[filterType] = [selectedValue];
            } else {
                delete activeFilters[filterType];
            }
            
            // Close dropdown
            closeAllDropdowns();
            
            // Apply filters and update UI
            applyNewFilters();
            updateActiveFilterChips();
            updateActiveFilterCount();
        }

        function getCardIssuerCategory(card) {
            // Map card bankType/issuer to filter categories
            const bankType = card.bankType || card.issuer || '';
            const name = card.name.toLowerCase();
            
            // Check by bankType first
            if (bankType === 'amex' || bankType === 'american-express') return 'amex';
            if (bankType === 'chase') return 'chase';
            if (bankType === 'capital-one') return 'capital-one';
            if (bankType === 'citi') return 'citi';
            if (bankType === 'discover') return 'discover';
            if (bankType === 'bilt') return 'bilt';
            if (bankType === 'wells-fargo') return 'wells-fargo';
            if (bankType === 'bank-of-america') return 'bank-of-america';
            if (bankType === 'us-bank') return 'us-bank';
            if (bankType === 'fidelity') return 'fidelity';
            
            // Check by card name if bankType doesn't match
            if (name.includes('amex') || name.includes('american express')) return 'amex';
            if (name.includes('chase')) return 'chase';
            if (name.includes('capital one') || name.includes('venture')) return 'capital-one';
            if (name.includes('citi')) return 'citi';
            if (name.includes('discover')) return 'discover';
            if (name.includes('bilt')) return 'bilt';
            if (name.includes('wells fargo')) return 'wells-fargo';
            if (name.includes('bank of america') || name.includes('boa')) return 'bank-of-america';
            if (name.includes('us bank') || name.includes('u.s. bank')) return 'us-bank';
            if (name.includes('fidelity')) return 'fidelity';
            if (name.includes('airline') || name.includes('delta') || name.includes('united') || name.includes('american airlines')) return 'airlines';
            if (name.includes('hotel') || name.includes('marriott') || name.includes('hilton') || name.includes('hyatt')) return 'hotels';
            
            return 'other';
        }

        function applyNewFilters() {
            // Apply the new filter system
            console.log('🔍 Starting filter process with activeFilters:', activeFilters);
            console.log('🔍 Available cards:', allCards.map(c => ({ name: c.name, type: c.type })));
            
            filteredCards = allCards.filter(card => {
                console.log(`🔍 Checking card: ${card.name} (type: ${card.type})`);
                for (const [filterType, filterValues] of Object.entries(activeFilters)) {
                    if (filterType === 'fee') {
                        if (filterValues.includes('0-100') && (card.annualFee < 0 || card.annualFee > 100)) return false;
                        if (filterValues.includes('100-300') && (card.annualFee < 100 || card.annualFee > 300)) return false;
                        if (filterValues.includes('300-500') && (card.annualFee < 300 || card.annualFee > 500)) return false;
                        if (filterValues.includes('500+') && card.annualFee < 500) return false;
                    } else if (filterType === 'type' || filterType === 'rewards') {
                        // Handle both single string and array values for type/rewards
                        let cardValue = card[filterType];
                        console.log(`🔍 Filtering ${filterType}: card value =`, cardValue, 'filter values =', filterValues);
                        console.log(`🔍 cardValue type:`, typeof cardValue);
                        console.log(`🔍 Array.isArray(cardValue):`, Array.isArray(cardValue));
                        console.log(`🔍 cardValue constructor:`, cardValue.constructor);
                        
                        // Check if cardValue is a string representation of an array and parse it
                        if (typeof cardValue === 'string' && cardValue.startsWith('[') && cardValue.endsWith(']')) {
                            try {
                                cardValue = JSON.parse(cardValue);
                                console.log(`🔍 Parsed string to array:`, cardValue);
                            } catch (e) {
                                console.log(`🔍 Failed to parse string as array:`, e);
                            }
                        }
                        
                        if (Array.isArray(cardValue)) {
                            // If card has multiple types/rewards, check if any match the filter
                            const hasMatch = filterValues.some(filterValue => cardValue.includes(filterValue));
                            console.log(`🔍 Array check: hasMatch = ${hasMatch}`);
                            if (!hasMatch) return false;
                        } else {
                            // Handle single string value (backward compatibility)
                            const hasMatch = filterValues.includes(cardValue);
                            console.log(`🔍 String check: hasMatch = ${hasMatch}`);
                            if (!hasMatch) return false;
                        }
                    } else if (filterType === 'issuer') {
                        // Map card issuer/bankType to filter values
                        const cardIssuer = getCardIssuerCategory(card);
                        if (!filterValues.includes(cardIssuer)) return false;
                    } else if (filterType === 'perks') {
                        // Check if card has any of the selected perks
                        const cardPerks = card.perkCategories || [];
                        const hasPerk = filterValues.some(perk => cardPerks.includes(perk));
                        if (!hasPerk) return false;
                    } else if (filterType === 'airline-hotel') {
                        // Check if card has any of the selected airline/hotel categories
                        const cardAirlineHotel = card.airline_hotels || card.airline_hotel || [];
                        const hasAirlineHotel = filterValues.some(airlineHotel => cardAirlineHotel.includes(airlineHotel));
                        if (!hasAirlineHotel) return false;
                    } else if (filterType === 'protections') {
                        // Check if card has any of the selected protections
                        const cardProtections = card.protectionCategories || [];
                        const hasProtection = filterValues.some(protection => cardProtections.includes(protection));
                        if (!hasProtection) return false;
                                    
                    }
                }
                return true;
            });

            renderCards();
            updateResultsCount();
        }

        function updateActiveFilterChips() {
            const container = document.getElementById('active-filters-chips');
            const line = document.getElementById('active-filters-line');
            container.innerHTML = '';
            
            if (Object.keys(activeFilters).length === 0) {
                line.style.display = 'none';
                return;
            }
            
            line.style.display = 'block';
            
            for (const [filterType, filterValues] of Object.entries(activeFilters)) {
                filterValues.forEach(value => {
                    const chip = document.createElement('div');
                    chip.className = 'active-filter-chip';
                    chip.innerHTML = `
                        ${getFilterDisplayName(filterType, value)}
                        <button class="remove-filter" onclick="removeFilter('${filterType}', '${value}')">&times;</button>
                    `;
                    container.appendChild(chip);
                });
            }
            
            // Update URL with current filters
            updateURLWithFilters();
        }

        function getFilterDisplayName(filterType, value) {
            const displayNames = {
                'type': {
                    'travel': 'Travel',
                    'cashback': 'Cashback',
                    'hybrid': 'Hybrid',
                    'business': 'Business'
                },
                'issuer': {
                    'amex': 'American Express',
                    'chase': 'Chase',
                    'capital-one': 'Capital One',
                    'wells-fargo': 'Wells Fargo',
                    'citi': 'Citi',
                    'discover': 'Discover',
                    'bilt': 'Bilt',
                    'bank-of-america': 'Bank of America',
                    'us-bank': 'U.S. Bank',
                    'fidelity': 'Fidelity'
                },
                'fee': {
                    '0-100': '$0-$100',
                    '100-300': '$100-$300',
                    '300-500': '$300-$500',
                    '500+': '$500+'
                },
                'perks': {
                    'lounge-access': 'Lounge Access',
                    'tsa-precheck': 'TSA Pre/Global Entry',
                    'clear': 'CLEAR',
                    'no-foreign-fees': 'No Foreign Transaction Fees',
                    'metal-card': 'Metal Card',
                    'free-checked-bags': 'Free Checked Bags',
                    'priority-boarding': 'Priority Boarding',
                    'annual-free-night': 'Annual Free Night',
                    'automatic-elite-status': 'Automatic Elite Status'
                },
                'airline-hotel': {
                    'delta': 'Delta',
                    'united': 'United',
                    'american': 'American Airlines',
                    'southwest': 'Southwest',
                    'jetblue': 'JetBlue',
                    'alaska': 'Alaska Airlines',
                    'marriott': 'Marriott',
                    'hilton': 'Hilton',
                    'hyatt': 'Hyatt',
                    'ihg': 'IHG'
                },
                'protections': {
                    'trip-delay-cancellation': 'Trip Delay & Cancellation Insurance',
                    'lost-delayed-baggage': 'Lost/Delayed Baggage Insurance',
                    'rental-car-insurance': 'Primary Rental Car Coverage',
                    'cell-phone-protection': 'Cell Phone Protection',
                    'purchase-protection': 'Purchase Protection',
                    'extended-warranty': 'Extended Warranty'
                }
            };
            
            return displayNames[filterType]?.[value] || value;
        }

        function removeFilter(filterType, value) {
            if (activeFilters[filterType]) {
                if (Array.isArray(activeFilters[filterType])) {
                    activeFilters[filterType] = activeFilters[filterType].filter(v => v !== value);
                    if (activeFilters[filterType].length === 0) {
                        delete activeFilters[filterType];
                    }
                } else {
                    delete activeFilters[filterType];
                }
            }
            
            applyNewFilters();
            updateActiveFilterChips();
            updateActiveFilterCount();
        }

        function updateActiveFilterCount() {
            const count = Object.values(activeFilters).flat().length;
            const activeFilterCountElement = document.getElementById('active-filter-count');
            if (activeFilterCountElement) {
                activeFilterCountElement.textContent = count;
            }
        }

        function openAllFiltersModal() {
            // For now, just show an alert. In a full implementation, this would open a modal
            alert('All Filters Modal - This would show all filter options in a modal with accordion sections.');
        }

        // Update URL with current filters
        function updateURLWithFilters() {
            const url = new URL(window.location);
            const searchParams = url.searchParams;
            
            // Clear existing filter params
            searchParams.delete('type');
            searchParams.delete('issuer');
            searchParams.delete('fee');
            searchParams.delete('perks');
            searchParams.delete('protections');
            
            // Add current filters to URL
            Object.entries(activeFilters).forEach(([filterType, values]) => {
                if (Array.isArray(values)) {
                    values.forEach(value => {
                        searchParams.append(filterType, value);
                    });
                }
            });
            
            // Update URL without reloading the page
            window.history.replaceState({}, '', url);
        }

        // Read filters from URL and apply them
        function readFiltersFromURL() {
            const url = new URL(window.location);
            const searchParams = url.searchParams;
            const urlFilters = {};
            
            // Read all filter parameters from URL
            ['type', 'issuer', 'fee', 'perks', 'protections'].forEach(filterType => {
                const values = searchParams.getAll(filterType);
                if (values.length > 0) {
                    urlFilters[filterType] = values;
                }
            });
            
            // Apply URL filters if any exist
            if (Object.keys(urlFilters).length > 0) {
                activeFilters = urlFilters;
                
                // Update checkboxes to match URL filters
                updateCheckboxesFromFilters();
                
                // Apply filters and update UI
                applyNewFilters();
                updateActiveFilterChips();
                updateActiveFilterCount();
            }
        }

        // Update checkboxes to match current filters
        function updateCheckboxesFromFilters() {
            // Clear all checkboxes first
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Check boxes that match current filters
            Object.entries(activeFilters).forEach(([filterType, values]) => {
                values.forEach(value => {
                    // Update desktop checkboxes
                    const desktopCheckbox = document.querySelector(`input[name="${filterType}"][value="${value}"]`);
                    if (desktopCheckbox) {
                        desktopCheckbox.checked = true;
                    }
                    
                    // Update mobile checkboxes
                    const mobileCheckbox = document.querySelector(`input[name="mobile-${filterType}"][value="${value}"]`);
                    if (mobileCheckbox) {
                        mobileCheckbox.checked = true;
                    }
                });
            });
        }

        // Add error handling to prevent null reference errors
        function safeUpdateElement(elementId, textContent) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = textContent;
            }
        }

        // Mobile Filters Functions
        function openMobileFilters() {
            const overlay = document.getElementById('mobile-filters-overlay');
            overlay.classList.add('active');
            
            // Sync mobile filters with current active filters
            syncMobileFilters();
            
            // Update mobile counts
            updateMobileCounts();
        }

        function closeMobileFilters() {
            const overlay = document.getElementById('mobile-filters-overlay');
            overlay.classList.remove('active');
        }

        function toggleMobileSection(sectionType) {
            const header = document.querySelector(`[onclick="toggleMobileSection('${sectionType}')"]`);
            const options = document.getElementById(`mobile-${sectionType}-options`);
            
            header.classList.toggle('expanded');
            options.classList.toggle('expanded');
        }

        function syncMobileFilters() {
            // Sync all filter types
            ['type', 'issuer', 'fee', 'perks', 'protections'].forEach(filterType => {
                if (activeFilters[filterType] && activeFilters[filterType].length > 0) {
                    // Check the checkboxes that match current filters
                    activeFilters[filterType].forEach(value => {
                        const checkbox = document.querySelector(`input[name="mobile-${filterType}"][value="${value}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                } else {
                    // Uncheck all checkboxes for this filter type
                    document.querySelectorAll(`input[name="mobile-${filterType}"]`).forEach(cb => {
                        cb.checked = false;
                    });
                }
            });
        }

        function applyMobileFilters() {
            // Collect mobile filter values
            const newFilters = {};

            // Handle all filter types
            ['type', 'issuer', 'fee', 'perks', 'protections'].forEach(filterType => {
                const selected = Array.from(document.querySelectorAll(`input[name="mobile-${filterType}"]:checked`)).map(cb => cb.value);
                if (selected.length > 0) {
                    newFilters[filterType] = selected;
                }
            });

            // Update active filters
            activeFilters = newFilters;

            // Apply filters and update UI
            applyNewFilters();
            updateActiveFilterChips();
            updateActiveFilterCount();
            updateMobileCounts();

            // Close mobile overlay
            closeMobileFilters();
        }

        function reloadCardsData() {
            console.log('Manually reloading cards data...');
            initializeCards();
            resetAllFilters();
            console.log('Cards reloaded:', allCards.length, 'cards');
        }

        function resetAllFilters() {
            console.log('resetAllFilters called - clearing all filters');
            
            // Reset all mobile inputs
            document.querySelectorAll('input[name^="mobile-"]').forEach(input => {
                if (input.type === 'radio') {
                    if (input.value === 'all') input.checked = true;
                    else input.checked = false;
                } else {
                    input.checked = false;
                }
            });

            // Clear active filters
            activeFilters = {};
            console.log('Active filters cleared, activeFilters:', activeFilters);

            // Apply changes
            applyNewFilters();
            updateActiveFilterChips();
            updateActiveFilterCount();
            updateMobileCounts();
            updateURLWithFilters();
            
            // Force reset mobile pills multiple times to ensure they're cleared
            forceResetMobilePills();
        }

        // Dedicated function to force reset mobile pills
        function forceResetMobilePills() {
            console.log('forceResetMobilePills called');
            
            // Remove active class immediately
            document.querySelectorAll('.mobile-quick-pill').forEach(pill => {
                console.log('Immediately removing active from:', pill.textContent.trim());
                pill.classList.remove('active');
            });
            
            // Remove again after a short delay
            setTimeout(() => {
                document.querySelectorAll('.mobile-quick-pill').forEach(pill => {
                    console.log('Delayed removal of active from:', pill.textContent.trim());
                    pill.classList.remove('active');
                });
            }, 50);
            
            // Remove one more time after a longer delay
            setTimeout(() => {
                document.querySelectorAll('.mobile-quick-pill').forEach(pill => {
                    console.log('Final removal of active from:', pill.textContent.trim());
                    pill.classList.remove('active');
                });
                console.log('Mobile pills force reset complete');
            }, 200);
        }

        function updateMobileCounts() {
            const activeCount = Object.values(activeFilters).flat().length;
            const resultsCount = filteredCards.length;
            
            safeUpdateElement('mobile-active-count', activeCount);
            safeUpdateElement('mobile-results-count', `${resultsCount} FOUND`);
            safeUpdateElement('mobile-results-btn-count', resultsCount);
        }

        function clearAllFilters() {
            activeFilters = {};
            applyNewFilters();
            updateActiveFilterChips();
            updateActiveFilterCount();
            updateURLWithFilters();
        }

        // Auto-apply filters function for desktop
        function autoApplyFilters() {
            // Collect all checkbox values
            const newFilters = {};
            
            // Collect type filters
            const typeCheckboxes = document.querySelectorAll('input[name="type"]:checked');
            if (typeCheckboxes.length > 0) {
                newFilters.type = Array.from(typeCheckboxes).map(cb => cb.value);
            }
            
            // Collect issuer filters
            const issuerCheckboxes = document.querySelectorAll('input[name="issuer"]:checked');
            if (issuerCheckboxes.length > 0) {
                newFilters.issuer = Array.from(issuerCheckboxes).map(cb => cb.value);
            }
            
            // Collect fee filters
            const feeCheckboxes = document.querySelectorAll('input[name="fee"]:checked');
            if (feeCheckboxes.length > 0) {
                newFilters.fee = Array.from(feeCheckboxes).map(cb => cb.value);
            }
            
            // Collect perks filters
            const perksCheckboxes = document.querySelectorAll('input[name="perks"]:checked');
            if (perksCheckboxes.length > 0) {
                newFilters.perks = Array.from(perksCheckboxes).map(cb => cb.value);
            }
            
            // Collect airline/hotel filters
            const airlineHotelCheckboxes = document.querySelectorAll('input[name="airline-hotel"]:checked');
            if (airlineHotelCheckboxes.length > 0) {
                newFilters['airline-hotel'] = Array.from(airlineHotelCheckboxes).map(cb => cb.value);
            }
            
            // Collect protections filters
            const protectionsCheckboxes = document.querySelectorAll('input[name="protections"]:checked');
            if (protectionsCheckboxes.length > 0) {
                newFilters.protections = Array.from(protectionsCheckboxes).map(cb => cb.value);
            }
            
            // Update active filters
            activeFilters = newFilters;
            
            // Apply filters and update UI
            applyNewFilters();
            updateActiveFilterChips();
            updateActiveFilterCount();
        }

        // Auto-apply filters function for mobile
        function autoApplyMobileFilters() {
            // Collect all mobile checkbox values
            const newFilters = {};
            
            // Collect type filters
            const typeCheckboxes = document.querySelectorAll('input[name="mobile-type"]:checked');
            if (typeCheckboxes.length > 0) {
                newFilters.type = Array.from(typeCheckboxes).map(cb => cb.value);
            }
            
            // Collect issuer filters
            const issuerCheckboxes = document.querySelectorAll('input[name="mobile-issuer"]:checked');
            if (issuerCheckboxes.length > 0) {
                newFilters.issuer = Array.from(issuerCheckboxes).map(cb => cb.value);
            }
            
            // Collect perks filters
            const perksCheckboxes = document.querySelectorAll('input[name="mobile-perks"]:checked');
            if (perksCheckboxes.length > 0) {
                newFilters.perks = Array.from(perksCheckboxes).map(cb => cb.value);
            }
            
            // Collect airline/hotel filters
            const airlineHotelCheckboxes = document.querySelectorAll('input[name="mobile-airline-hotel"]:checked');
            if (airlineHotelCheckboxes.length > 0) {
                newFilters['airline-hotel'] = Array.from(airlineHotelCheckboxes).map(cb => cb.value);
            }
            
            // Collect protections filters
            const protectionsCheckboxes = document.querySelectorAll('input[name="mobile-protections"]:checked');
            if (protectionsCheckboxes.length > 0) {
                newFilters.protections = Array.from(protectionsCheckboxes).map(cb => cb.value);
            }
            
            // Collect fee filters
            const feeCheckboxes = document.querySelectorAll('input[name="mobile-fee"]:checked');
            if (feeCheckboxes.length > 0) {
                newFilters.fee = Array.from(feeCheckboxes).map(cb => cb.value);
            }
            
            // Update active filters
            activeFilters = newFilters;
            
            // Apply filters and update UI
            applyNewFilters();
            updateActiveFilterChips();
            updateActiveFilterCount();
            updateMobileCounts();
        }

        // Quick filter function for mobile pills
        function quickFilter(filterType, value) {
            console.log('quickFilter called with:', filterType, value);
            
            // Clear any existing filters of this type
            delete activeFilters[filterType];
            
            // Set the new filter
            activeFilters[filterType] = [value];
            
            // Apply filters and update UI
            applyNewFilters();
            updateActiveFilterChips();
            updateActiveFilterCount();
            
            // Update mobile pill active states
            updateMobilePillStates(filterType, value);
        }

        function updateMobilePillStates(activeType, activeValue) {
            // Remove active class from all mobile pills
            document.querySelectorAll('.mobile-quick-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            
            // Add active class to the selected pill (only if we have valid values)
            if (activeType && activeValue) {
                if (activeType === 'type') {
                    if (activeValue === 'travel') {
                        document.querySelector('.mobile-quick-pill:nth-child(2)').classList.add('active');
                    } else if (activeValue === 'cashback') {
                        document.querySelector('.mobile-quick-pill:nth-child(3)').classList.add('active');
                    }
                }
            }
            // If no activeType/activeValue (reset case), all pills remain inactive
        }



        function applySorting(sortBy) {
            switch(sortBy) {
                case 'name':
                    filteredCards.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'fee-low':
                    filteredCards.sort((a, b) => a.annualFee - b.annualFee);
                    break;
                case 'fee-high':
                    filteredCards.sort((a, b) => b.annualFee - a.annualFee);
                    break;
                case 'rating':
                    // Placeholder for rating sorting
                    break;
                default:
                    // Featured order (original order)
                    filteredCards = [...allCards];
                    applyNewFilters(); // Re-apply filters
                    return;
            }
            
            renderCards();
        }

        function updateResultsCount() {
            // Update results count in the active filters line if it exists
            const resultsCountElement = document.getElementById('results-count');
            if (resultsCountElement) {
                resultsCountElement.textContent = filteredCards.length;
            }
            
            const totalCountElement = document.getElementById('total-count');
            if (totalCountElement) {
                totalCountElement.textContent = allCards.length;
            }

            // Update the main results display
            const resultsDisplayCount = document.getElementById('results-display-count');
            if (resultsDisplayCount) {
                resultsDisplayCount.textContent = filteredCards.length;
            }

            const resultsDisplayTotal = document.getElementById('results-display-total');
            if (resultsDisplayTotal) {
                resultsDisplayTotal.textContent = allCards.length;
            }
        }

        function refreshCards() {
            // Reload cards from storage and reapply current filters
            initializeCards();
            applyNewFilters();
        }

        // Header background on scroll
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (header && window.scrollY > 100) {
                header.style.background = 'linear-gradient(135deg, rgba(15, 32, 39, 0.98) 0%, rgba(32, 58, 67, 0.98) 70%, rgba(44, 83, 100, 0.98) 100%)';
                header.style.boxShadow = '0 4px 20px rgba(168, 230, 207, 0.2)';
            } else if (header) {
                header.style.background = 'linear-gradient(135deg, #0f2027 0%, #0f2027 30%, #203a43 70%, #2c5364 100%)';
                header.style.boxShadow = 'none';
            }
        });

        // Mobile menu functionality is handled by the dynamic header
    </script>
    <script src="js/scripts.js"></script>
</body>
</html>